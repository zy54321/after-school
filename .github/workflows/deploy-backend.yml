# name: Deploy Backend to Tencent Cloud

# on:
#   push:
#     branches: [ "main" ]
#     paths:
#       - "server/**"
#       - ".github/workflows/deploy-backend.yml"

# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: ğŸšš Checkout code
#         uses: actions/checkout@v4

#       - name: ğŸš€ Deploy via SSH
#         uses: appleboy/ssh-action@v1.0.3
#         with:
#           host: ${{ secrets.SSH_HOST }}
#           username: ${{ secrets.SSH_USERNAME }}
#           key: ${{ secrets.SSH_PRIVATE_KEY }}
#           port: 22
#           script: |
#             echo "1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•..."
#             cd /var/www/after-school

#             echo "2. å¼ºåˆ¶åŒæ­¥æœ€æ–°ä»£ç ..."
#             git fetch --all
#             git reset --hard origin/main

#             echo "3. è¿›å…¥åç«¯ç›®å½•..."
#             cd server
            
#             echo "4. å®‰è£…/æ›´æ–°ä¾èµ–..."
#             npm install --production

#             echo "5. é‡å¯ PM2 æœåŠ¡..."
#             # ğŸŸ¢ ä¿®æ­£ï¼šä½¿ç”¨æ­£ç¡®çš„è¿›ç¨‹å "after-school"
#             # ä¸‹é¢è¿™è¡Œå‘½ä»¤çš„æ„æ€æ˜¯ï¼šå°è¯•é‡å¯ï¼Œå¦‚æœå¤±è´¥ï¼ˆè¿›ç¨‹ä¸å­˜åœ¨ï¼‰ï¼Œåˆ™å¯åŠ¨å®ƒ
#             pm2 restart after-school --update-env || pm2 start app.js --name "after-school" --log-date-format "YYYY-MM-DD HH:mm:ss"
            
#             echo "6. ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨..."
#             pm2 save

#             echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
